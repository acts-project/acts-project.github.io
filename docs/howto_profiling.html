<!-- HTML header for doxygen 1.12.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ACTS: Performance Profiling</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script>
MathJax = {
  tex: {
    inlineMath: {'[+]': [['$', '$']]}
  },
};
</script>
<script id="MathJax-script" async src="tex-mml-chtml.js"></script>
<!-- <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
 -->
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
</script>
<!-- ACTS Version Manager -->
<link href="acts-version-manager.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="acts-version-manager.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="acts_logo_colored.svg"/></td>
  <td id="projectalign">
   <div id="projectname">ACTS
   </div>
   <div id="projectbrief">Experiment-independent tracking</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('howto_profiling.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Performance Profiling </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Guide on using <span class="tt">gperftools</span> and <span class="tt">pprof</span> for profiling ACTS.</p>
<p>Software profiling allows you to inspect the performance of a piece of software, seeing where the bottlenecks are and how they can be improved. gperftools is a software profiling package. It contains a CPU profiler, thread-caching malloc library, memory leak detection tool, memory allocation profiler and pprof (discussed later). More information about gperftools and its components can be found on the project's <a href="https://github.com/gperftools/gperftools">GitHub</a> and <a href="https://gperftools.github.io/gperftools/">documentation page</a>.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md37"></a>
Install gperftools</h2>
<p>It is strongly recommended to install <a href="https://github.com/libunwind/libunwind">libunwind</a> before trying to configure or install gperftools.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md38"></a>
Ubuntu</h3>
<p>If you're using Ubuntu you can use the following command to install gperftools:</p>
<div class="fragment"><div class="line">apt install google-perftools libgoogle-perftools-dev</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="autotoc_md39"></a>
Other Systems</h3>
<p>Alternatively, you can use the following commands to install it:</p>
<div class="fragment"><div class="line">git clone https://github.com/gperftools/gperftools</div>
<div class="line">cd gperftools</div>
<div class="line">git tag -l # checkout the latest release version</div>
<div class="line">git checkout &lt;gperftools-X.x&gt;</div>
<div class="line">./autogen.sh</div>
<div class="line">./configure --prefix=&lt;your/desired/install/dir&gt;</div>
<div class="line">make</div>
<div class="line">make install</div>
</div><!-- fragment --><p>This will install gperftools in <span class="tt">your/desired/install/dir/lib</span> which is the path you should use when specifying where gperftools is, if necessary.</p>
<p>If you wish to install gperftools to a directory that is not one of the standard directories for libraries and therefore not findable by the <span class="tt">-l</span> compiler flag, you will need to specify the path to it with the <span class="tt">GPERF_INSTALL_DIR</span> option at build time. Further information about installing gperftools is <a href="https://github.com/gperftools/gperftools/blob/master/INSTALL">here</a>.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md40"></a>
pprof</h2>
<p>pprof is a tool for visualising and analysing profiling data. An older version of pprof comes bundled with gperftools but using the newer Go version comes with several benefits: nicer looking graphs and additional options that make looking through specific sections of a program easier being among them.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md41"></a>
Install Go pprof (Optional)</h3>
<p>First, you must install Go. Instructions to do so are available <a href="https://go.dev/doc/install">here</a>. Optionally, you can install <a href="https://www.graphviz.org/download/">Graphviz</a> to produce visualisations of profiles.</p>
<p>Then, run the following command to install pprof itself:</p>
<div class="fragment"><div class="line">go install github.com/google/pprof@latest</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md42"></a>
Link gperftools Libraries When Compiling</h2>
<p>The library needed to run the CPU profiler should be linked into the ACTS project using the following build option:</p>
<div class="fragment"><div class="line">-DACTS_ENABLE_CPU_PROFILING=ON</div>
</div><!-- fragment --><p>Similarly, to enable the memory profiler the following build option should be used:</p>
<div class="fragment"><div class="line">-DACTS_ENABLE_MEMORY_PROFILING=ON</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md43"></a>
Alternative to Recompiling</h2>
<p>Alternatively, you can avoid rebuilding the project by pointing the <span class="tt">LD_PRELOAD</span> environment variable to the profiler library for CPU profiling:</p>
<div class="fragment"><div class="line">LD_PRELOAD=&quot;&lt;path/to/libprofiler.so&gt;&quot; &lt;other_options&gt; &lt;path/to/binary&gt; &lt;binary_flags&gt;</div>
</div><!-- fragment --><p>You can do the same thing with the tcmalloc library for memory profiling:</p>
<div class="fragment"><div class="line">LD_PRELOAD=&quot;&lt;path/to/libtcmalloc.so&gt;&quot; &lt;other_options&gt; &lt;path/to/binary&gt; &lt;binary_flags&gt;</div>
</div><!-- fragment --><p>Using the <span class="tt">LD_PRELOAD</span> method is not recommended by the developers of gperftools so using the build options is preferable. Both CPU and memory profiling can be enabled at the same time but note that turning on memory profiling (or the heap checker) will affect performance. Specify multiple libraries to load with <span class="tt">LD_PRELOAD</span> using a space-separated list e.g.</p>
<div class="fragment"><div class="line">LD_PRELOAD=&quot;&lt;path/to/first/library&gt; &lt;path/to/second/library&gt;&quot;</div>
</div><!-- fragment --><p>Note that these steps don't turn on profiling, they only enable it to work. The following section details how to turn it on.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md44"></a>
Produce a CPU Profile</h2>
<p>To turn on CPU profiling when running an executable define the <span class="tt">CPUPROFILE</span> environment variable when executing the program:</p>
<div class="fragment"><div class="line">CPUPROFILE=&lt;path/to/profile&gt; &lt;path/to/binary&gt; [binary args]</div>
</div><!-- fragment --><p>This variable specifies where the profile will be written to. There are additional environment variables that modify the behaviour of the profiler. <a href="https://github.com/gperftools/gperftools">Would you like to know more</a>?</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md45"></a>
Produce a Memory Profile</h2>
<p>To turn on memory profiling use the following command:</p>
<div class="fragment"><div class="line">HEAPPROFILE=&lt;path/to/profile&gt; &lt;path/to/binary&gt; [binary args]</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md46"></a>
Run the Heap Checker</h2>
<p>To run the heap checker for checking for memory leaks run the following command:</p>
<div class="fragment"><div class="line">PPROF_PATH=&lt;path/to/pprof&gt; HEAPCHECK=normal &lt;path/to/binary&gt; [binary args]</div>
</div><!-- fragment --><p>The CPU profiler, memory profiler and heap checker can be used in tandem.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md47"></a>
Using pprof</h2>
<h3 class="doxsection"><a class="anchor" id="autotoc_md48"></a>
View Profile as a Graph</h3>
<p>A graphical representation of a profile can be produced using:</p>
<div class="fragment"><div class="line">pprof -pdf &lt;path/to/binary&gt; &lt;path/to/profile&gt; &gt; &lt;path/to/pdf&gt;</div>
</div><!-- fragment --><p>Where <span class="tt">path/to/binary</span> is the binary is used to produce the profile in the first place. Other output formats are available.</p>
<p>The following opens the graph in your web browser:</p>
<div class="fragment"><div class="line">pprof -web &lt;path/to/binary&gt; &lt;path/to/profile&gt;</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="autotoc_md49"></a>
Interactive Mode</h3>
<p>To launch pprof in interactive mode use the following command:</p>
<div class="fragment"><div class="line">pprof &lt;path/to/binary&gt; &lt;path/to/profile&gt;</div>
</div><!-- fragment --><p>The following command will display the top x entries by the current sorting criteria:</p>
<div class="fragment"><div class="line">top &lt;number&gt;</div>
</div><!-- fragment --><p>To view the statistics of a function line by line use:</p>
<div class="fragment"><div class="line">list &lt;nameOfFunction&gt;</div>
</div><!-- fragment --><p>Various options can be specified to filter, sort and set the granularity of entries. There are also a number of other commands available. Read more about pprof <a href="https://github.com/google/pprof">here</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>
